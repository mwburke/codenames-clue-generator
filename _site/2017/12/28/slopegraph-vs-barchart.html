<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slopegraph vs Barchart - Works of Chart</title>
    <meta name="author"  content="Matthew Burke">
    <meta name="description" content="Slopegraph vs Barchart">
    <meta name="keywords"  content="data-viz, d3">
    <!-- Open Graph -->
    <meta property="og:title" content="Slopegraph vs Barchart - Works of Chart">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2017/12/28/slopegraph-vs-barchart.html">
    <meta property="og:description" content="Making sense of data">
    <meta property="og:site_name" content="Works of Chart">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    
    <!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

    
</head>
<body>
    <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
<input id="nm-switch" type="hidden" value="false">

<header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
            <li><a href="/about.html">about</a></li>
            
        </ul>
    </nav>
</header>


<header class="g-banner post-header post-pattern-circuitBoard bgcolor-default " data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="http://localhost:4000/tags#data-viz" class="post-tag">data-viz</a>
            
            <a href="http://localhost:4000/tags#d3" class="post-tag">d3</a>
            
            
        </div>
        <h1>Slopegraph vs Barchart</h1>
        <div class="post-meta">
            <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="http://localhost:4000" target="_blank" rel="author">Matthew</a></></span>
            <time class="post-meta-item" datetime="17-12-28"><i class="iconfont icon-date"></i>28 Dec 2017</time>
        </div>
    </div>
    
    <div class="filter"></div>
    <div class="post-cover" style="background: url('https://raw.githubusercontent.com/mwburke/ds-tools-2017-slopegraph/master/preview.png') center no-repeat; background-size: cover;">
    
</header>

<div class="post-content">
    
    <article class="markdown-body">
        <h2 id="slopegraphs-are-great-sometimes">Slopegraphs are great (…sometimes)</h2>

<p>A slopegraph is a relatively underused chart with two sets of values on the left and right hand side, connected by lines. I know this sounds like a line chart with two values… and it kind of is… but trust me it has its uses.</p>

<p>Slopegraphs were first developed by the illustrious Edward Tufte, and you can see an example of one in his book <a href="https://www.edwardtufte.com/tufte/books_vdqi"><em>The Visual Display of Quantitative Information</em></a> below:</p>

<p><img src="https://www.edwardtufte.com/bboard/images/0003nk-10289.gif" alt="https://www.edwardtufte.com/bboard/q-and-a-fetch-msg?msg_id=0003nk" /></p>

<p>The slopegraph is successful in accomplishing the following communication goals:</p>

<ul>
  <li>Showing relative rankings of items</li>
  <li>Identifying magnitude of changes</li>
  <li>Allowing comparison of changes among items</li>
</ul>

<h3 id="slopegraph-vs-bar-chart">Slopegraph vs bar chart</h3>

<p>Although these tasks could be accomplished by reading a bar chart, I believe a slopegraph is a more appropriate visualization in some cases.</p>

<p>One example is taken from <a href="https://www.kdnuggets.com/2017/05/poll-analytics-data-science-machine-learning-software-leaders.html">KDnuggets poll</a> of data science software usage in recent years. From their bar chart below, you can get see trends by looking at each piece of software individually, but it’s difficult to compare across all of them.</p>

<p><img src="https://www.kdnuggets.com/images/top-analytics-data-science-machine-learning-software-2015-2017.jpg" alt="" /></p>

<p>To illustrate how this could be improved, I created a slopegraph for the some of the top items in D3 and embedded it below:</p>

<blockquote>
  <p>Data Science Tools % Usage: <strong>2016</strong> to <strong>2017</strong></p>
</blockquote>

<div id="chart"></div>

<h3 id="slopegraph-pros">Slopegraph pros</h3>

<p>The slopegraph makes better use of color to draw the reader’s eyes to significant changes, and immediately informs them of the increase or decrease. In the previous chart, the colors held no inherent meaning, and therefore added visual complexity for no additional benefit to the reader.</p>

<p>Additionally, I think the sloepgraph gives a better sense of the overall average trends through the line angles.</p>

<h3 id="slopegraph-cons">Slopegraph cons</h3>

<p>One of the primary shortcomings of the chart is the overlap of items with similar values. I had to add some extra logic in order to avoid this and still ended up with the SQL/Excel abomination, whereas if I used a bar chart, I would never have this problem.</p>

<p>The human brain is more suited to make comparisons between values based on length rather than angle, and I wouldn’t be able to determine whether a line reprsented a 7% or 8% increase innately, which is why you need to add in each of the percents on both sides of the chart.</p>

<h3 id="summary">Summary</h3>

<p>Every visualization tool has bar chart capabilities and every powerpoint will inevitably have at least one bar chart mainly because you won’t have to explain to your boss how to read a bar chart. They just work.</p>

<p>That being said, they don’t always work as well as they could, and I think putting in a little extra time coding up a custom slopegraph visualization in something like <a href="https://d3js.org/">D3</a> can make a significant difference in guiding people to the insights you’ve dug up.</p>

<hr />

<p>The code for the above slopegraph made with D3.js can be found <a href="https://github.com/mwburke/ds-tools-2017-slopegraph">in this github repo</a></p>

<p>You can view a live version <a href="http://bl.ocks.org/mwburke/9873c09ac6c21d6ac9153e54892cf5ec">in this block</a></p>

<style>

line {
	stroke-width: 3px;
	stroke-opacity: 0.7;
}


line.positive {
	stroke: #1b4fa3;
	stroke-width: 5px;
	stroke-opacity: 0.8;
}

line.negative {
	stroke: #991616;
	stroke-width: 5px;
	stroke-opacity: 0.8;
}

line.neutral {
	stroke: grey;
}


text.positive {
	fill: #1b4fa3;
	font-weight: 600;
}

text.negative {
	fill: #991616;
	font-weight: 600;
}

text.neutral {
	fill: grey;
}

.label {
	font-weight: 600;
}

circle.positive {
	fill: #1b4fa3;
}

circle.negative {
	fill: #991616;
}

circle.neutral {
	fill: grey;
}
</style>

<script src="http://d3js.org/d3.v4.min.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<script>

d3.json('/data/slopegraph-data.json', function(error, data) {
	if (error) throw error;

	// Label each point as increasing/decreasing above thresholds
	// or just little to no change
	var arrayLength = data.length;
	for (var i = 0; i < arrayLength; i++) {
	    change = data[i]['After'] - data[i]['Before'];
	    if (change < -3) {
	    	data[i]['Change'] = 'negative';
	    } else if (change > 5) {
	    	data[i]['Change'] = 'positive';
	    } else {
	    	data[i]['Change'] = 'neutral';
	    }
	}

	var opts = {
		width: 600,
		height: 500,
		margin: {top: 20, right: 100, bottom: 30, left: 150}
	};

	// Calculate area chart takes up out of entire svg
	var chartHeight = opts.height - opts.margin.top - opts.margin.bottom;
	var chartWidth = opts.width - opts.margin.left - opts.margin.right;


	var svg = d3.select('#chart')
		.append('svg')
		.attr('width', opts.width)
		.attr('height', opts.height);

	// Create scale for positioning data correctly in chart
	var vertScale = d3.scaleLinear().domain([6, 53]).range([opts.margin.bottom, chartHeight]);

	// Labels overlap, need to precompute chart height placement
	// and adjust to avoid label overlap

	// First, calculate the right and left side chart placements
	for (var i = 0; i < arrayLength; i++) {
		data[i]['AfterY'] = vertScale(data[i]['After']);
		data[i]['BeforeY'] = vertScale(data[i]['Before']);
	}

	// Next, use a basic heuristic to pull labels up or down
	// If next item is too close to next one, move label up
	// If next item is too close and item above has been moved up, keep the same value,
	// and move next value down

	data.sort(function(a, b) {
		return b.Before-a.Before;
	})

	

	for (var i = 1; i < (arrayLength - 1); i++) {
		if ((data[i]['BeforeY']-data[i+1]['BeforeY']) < 15) {
			if ((data[i-1]['BeforeY']-data[i]['BeforeY']) < 15) {
				data[i+1]['BeforeY'] = data[i+1]['BeforeY'] - 10;
			} else {
				data[i]['BeforeY'] = data[i]['BeforeY'] + 10;
			}
		}
	}

	data.sort(function(a, b) {
		return b.After-a.After;
	})

	console.log(data);

	for (var i = 1; i < (arrayLength - 1); i++) {

		if ((data[i]['AfterY']-data[i+1]['AfterY']) < 15) {
			if ((data[i-1]['AfterY']-data[i]['AfterY']) < 15) {
				data[i+1]['AfterY'] = data[i+1]['AfterY'] - 10;
			} else {
				data[i]['AfterY'] = data[i]['AfterY'] + 10;
			}
		} else if ((data[i-1]['AfterY']-data[i]['AfterY']) < 15) {
			data[i]['AfterY'] = data[i]['AfterY'] - 10;
		} 
	}

	data.sort(function(a, b) {
		return b.Before-a.Before;
	})

	// Create slopegraph labels
	svg.selectAll('text.labels')
		.data(data)
		.enter()
		.append('text')
		.text(function(d) {
			return d.Tool
		})
		.attr('class', function(d) {
			return 'label ' + d.Change;
		})
		.attr('text-anchor', 'end')
		.attr('x', opts.margin.left * .6)
		.attr('y', function(d) { 
			return opts.margin.top + chartHeight - d.BeforeY;
		})
		.attr('dy', '.35em');
	
	// Create slopegraph left value labels
	svg.selectAll('text.leftvalues')
		.data(data)
		.enter()
		.append('text')
		.attr('class', function(d) {
			return d.Change;
		})
		.text(function(d) {
			return Math.round(d.Before) + '%'
		})
		.attr('text-anchor', 'end')
		.attr('x', opts.margin.left * .85)
		.attr('y', function(d) { 
			return opts.margin.top + chartHeight - d.BeforeY;
		})
		.attr('dy', '.35em');

	// Create slopegraph left value labels
	svg.selectAll('text.rightvalues')
		.data(data)
		.enter()
		.append('text')
		.attr('class', function(d) {
			return d.Change;
		})
		.text(function(d) {
			return Math.round(d.After) + '%'
		})
		.attr('text-anchor', 'start')
		.attr('x', chartWidth + opts.margin.right)
		.attr('y', function(d) { 
			return opts.margin.top + chartHeight - d.AfterY;
		})
		.attr('dy', '.35em');

	// Create slopegraph lines
	svg.selectAll('line.slope-line')
		.data(data)
		.enter()
		.append('line')
		.attr('class', function(d) {
			return 'slope-line ' + d.Change;
		})
		.attr('x1', opts.margin.left)
		.attr('x2', chartWidth + opts.margin.right * 0.75)
		.attr('y1', function(d) { 
			return opts.margin.top + chartHeight - vertScale(d.Before);
		})
		.attr('y2', function(d) { 
			return opts.margin.top + chartHeight - vertScale(d.After);
		});
	
	// Create slopegraph left circles
	svg.selectAll('line.left-circle')
		.data(data)
		.enter()
		.append('circle')
		.attr('class', function(d) {
			return d.Change;
		})
		.attr('cx', opts.margin.left)
		.attr('cy', function(d) { 
			return opts.margin.top + chartHeight - vertScale(d.Before);
		})
		.attr('r', 6);

	// Create slopegraph right circles
	svg.selectAll('line.left-circle')
		.data(data)
		.enter()
		.append('circle')
		.attr('class', function(d) {
			return d.Change;
		})
		.attr('cx',chartWidth + opts.margin.right * 0.75)
		.attr('cy', function(d) { 
			return opts.margin.top + chartHeight - vertScale(d.After);
		})
		.attr('r', 6);

	// Create bottom area denoting years
	svg.append("line")
		.attr('x1', opts.margin.left)
		.attr('x2', opts.margin.left)
		.attr('y1', opts.height - opts.margin.bottom)
		.attr('y2', opts.height - opts.margin.bottom * 0.7)
		.attr('stroke', 'grey')
		.attr('stroke-width', '2px');

	svg.append("line")
		.attr('x1', chartWidth + opts.margin.right * 0.75)
		.attr('x2', chartWidth + opts.margin.right * 0.75)
		.attr('y1', opts.height - opts.margin.bottom)
		.attr('y2', opts.height - opts.margin.bottom * 0.7)
		.attr('stroke', 'grey')
		.attr('stroke-width', '2px');

	svg.append("line")
		.attr('x1', opts.margin.left)
		.attr('x2', chartWidth + opts.margin.right * 0.75)
		.attr('y1', opts.height - opts.margin.bottom * 0.7)
		.attr('y2', opts.height - opts.margin.bottom * 0.7)
		.attr('stroke', 'grey')
		.attr('stroke-width', '2px');

	svg.append('text')
		.text('2016')
		.attr('class', 'neutral')
		.attr('x', opts.margin.left)
		.attr('y', opts.height - opts.margin.bottom * 0.05)
		.attr('text-anchor', 'start');

	svg.append('text')
		.text('2017')
		.attr('class', 'neutral')
		.attr('x', chartWidth + opts.margin.right * 0.75)
		.attr('y', opts.height - opts.margin.bottom * 0.05)
		.attr('text-anchor', 'end');

	// Get y values of notes and add notes to viz
	var pythonY = data.filter(function (ind) {
		return ind.Tool == 'Python';
	});

	var rapidMinerY = data.filter(function (ind) {
		return ind.Tool == 'RapidMiner';
	});

	var tensorflowY = data.filter(function (ind) {
		return ind.Tool == 'Tensorflow';
	});

	svg.selectAll('text-comments')
		.data(data)
		.enter()
		.append('text')
		.text(function(d) {
			return d.Comments;
		})
		.attr('class', 'neutral')
		.attr('text-anchor', 'start')
		.attr('x', chartWidth + opts.margin.right)
		.attr('y', function(d) {
			return opts.margin.top + chartHeight - d.AfterY;
		})
		.attr('dy', '.25em')
		.call(wrap, opts.margin.right);

	function wrap(text, width) {
	  text.each(function() {
	    var text = d3.select(this),
	        words = text.text().split(/\s+/).reverse(),
	        word,
	        line = [],
	        lineNumber = 0,
	        lineHeight = 1.1, // ems
	        y = text.attr("y"),
	        dy = parseFloat(text.attr("dy")),
	        tspan = text.text(null).append("tspan").attr("x", chartWidth + opts.margin.left).attr("y", y).attr("dy", dy + "em");
	    while (word = words.pop()) {
	      line.push(word);
	      tspan.text(line.join(" "));
	      if (tspan.node().getComputedTextLength() > width) {
	        line.pop();
	        tspan.text(line.join(" "));
	        line = [word];
	        tspan = text.append("tspan").attr("x", chartWidth + opts.margin.left).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
	      }
	    }
	  });
	}
});

</script>


    </article>
    
</div>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="http://localhost:4000/assets/img/other-profile.jpg" alt="">
        </div>
        <div class="author-name" rel="author">Matthew Burke</div>
        <div class="bio">
            <p>Data Science, Data Viz, Web Stuff (sorta)</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="//twitter.com/mattburkeley" target="_blank">
                    <i class="iconfont icon-twitter"></i>
                </a>
            </li>
            
            <li>
                <a href="//www.linkedin.com/in/matthew-burke-data-science" target="_blank">
                    <i class="iconfont icon-linkedin"></i>
                </a>
            </li>
            
            <li>
                <a href="//github.com/mwburke" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        <div class="read-next-item">
            <a href="/2017/12/29/jekyll-and-d3.html" class="read-next-link"></a>
            <section>
                <span>Working with Jekyll and D3</span>
                <p>Getting tools to play niceJekyll is a fantastic framework...</p>
            </section>
            
        </div>
        
        
        <div class="read-next-item">
            <a href="/2017/12/23/why-make-a-blog.html" class="read-next-link"></a>
            <section>
                <span>Why Make A Blog</span>
                <p>Does the world need another blog?Short answer, no. There ...</p>
            </section>
            
            <div class="filter"></div>
            <img src="http://on2171g4d.bkt.clouddn.com/jekyll-banner.png" alt="">
            
        </div>
        
    </section>
    
</section>

<footer class="g-footer">
    <section>Works of Chart © 2018</section>
    <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>

<script src="/assets/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: ['twitter','linkedin','github'],
        wechatQrcodeTitle: "分享到微信朋友圈",
        wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
</script>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
/*写入自己的disqus信息*/
s.src = 'https://mwburke.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="/assets/js/prism.js"></script>
<script src="/assets/js/index.min.js"></script>
</body>
</html>
