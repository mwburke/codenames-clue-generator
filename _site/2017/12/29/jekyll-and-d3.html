<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working with Jekyll and D3 - Works of Chart</title>
    <meta name="author"  content="Matthew Burke">
    <meta name="description" content="Working with Jekyll and D3">
    <meta name="keywords"  content="jekyll, d3">
    <!-- Open Graph -->
    <meta property="og:title" content="Working with Jekyll and D3 - Works of Chart">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://worksofchart.com/2017/12/29/jekyll-and-d3.html">
    <meta property="og:description" content="Making sense of data">
    <meta property="og:site_name" content="Works of Chart">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    
    <!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

    
</head>

<body>
    <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
<input id="nm-switch" type="hidden" value="false">

<header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
            <li><a href="/about.html">about</a></li>
            
        </ul>
    </nav>
</header>


<header class="g-banner post-header post-pattern-circuitBoard bgcolor-default post-no-cover" data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="http://worksofchart.com/tags#jekyll" class="post-tag">jekyll</a>
            
            <a href="http://worksofchart.com/tags#d3" class="post-tag">d3</a>
            
            
        </div>
        <h1>Working with Jekyll and D3</h1>
        <div class="post-meta">
            <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="http://worksofchart.com" target="_blank" rel="author">Matthew</a></></span>
            <time class="post-meta-item" datetime="17-12-29"><i class="iconfont icon-date"></i>29 Dec 2017</time>
        </div>
    </div>
    
</header>

<div class="post-content">
    
    <h2 class="post-subtitle">Integration for Data-Oriented Blogging</h2>
    
    <article class="markdown-body">
        <h3 id="getting-tools-to-play-nice">Getting tools to play nice</h3>

<p>Jekyll is a fantastic framework to get up and running quickly with a blog website, and adding posts through markdown files abstracts a lot of the complexity for me, leaving more time to spend writing.</p>

<p>However, since it relies heavily on <a href="http://yaml.org/">YAML</a> configuration files and <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> rather than HTML and JSON, it doesn’t have many nice plug-n-play features with D3.</p>

<p>Luckily there are smart people out there like the <a href="http://apievangelist.com/">API Evangelist</a> (who you should seriously check out sometime), who help us plebeians out. He had a <a href="https://apievangelist.com/2016/09/20/d3js-visualizations-using-yaml-and-jekyll/">super helpful post</a> about getting D3 visualizations working with Jekyll. The strategy is basically to generate two separate files: a yaml file and instructions on how to compile that yaml file into JSON, so that when you build your site, you end up with the original JSON file you were working with when prototyping in D3.</p>

<h3 id="slopegraph-example">Slopegraph example</h3>

<p>In a <a href="http://worksofchart.com/2017/12/28/slopegraph-vs-barchart.html">previous post</a>, I created a slopegraph in D3, which utilized a JSON file (excerpt below):</p>

<pre><code class="language-json">[
	{"Tool":"Python",
	 "Users":1516,
	 "After":52.6,
	 "Before":45.8,
	 "Comments": "Python is growing in popularity"
	},
	{"Tool":"R",
	"Users":1502,
	"After":52.1,
	"Before":49.0
	}
...
</code></pre>

<h4 id="yaml-file">YAML File</h4>

<p>The initial way I generated the yaml file from JSON was using the <a href="https://github.com/drbild/json2yaml">json2yaml</a> command line tool. It’s basically just JSON except instead of curly brackets and quotations, it has indents and dashes. Here’s what the above JSON looked like after its transformation into yaml:</p>

<pre><code class="language-yaml">- Tool: Python
  Users: 1516
  After: 52.6
  Before: 45.8
  Comments: Python is growing in popularity
- Tool: R
  Users: 1502
  After: 52.1
  Before: 49.0
</code></pre>

<h4 id="conversion-definition-file">Conversion Definition File</h4>

<p>The last step is to create a <a href="http://shopify.github.io/liquid/">Liquid</a> template definition on how to regenerate JSON line by line as it iterates through the YAML, and the cycle is complete. The script looks like the following:</p>

<pre><code class="language-liquid">---
layout: none
---
[{% for chart in site.data.slopegraph-data %}
  {
    "Tool": "{{ chart.Tool }}",
    "Users": "{{ chart.Users }}",
    "After": "{{ chart.After }}",
    "Before": "{{ chart.Before }}",
    "Comments": "{{ chart.Comments }}"
  }{% if forloop.last == false %},{% endif %}
{% endfor %}]
</code></pre>

<h3 id="putting-it-together">Putting it together</h3>

<p>Since I <del>am good at</del> like using D3, I knew I would probably be repeating this process later. Rather than re-look up how to do this every time, I thought I would just create a quick python script to take a JSON file, auto generate the two files and place them in the appropriate folders.  The end result will be the JSON file receated in the <code>/data</code> folder of the generated site, ready for use.</p>

<p>The script I wrote is pretty basic, relies on the <a href="https://pypi.python.org/pypi/PyYAML"><code>pyaml</code></a> package, and does have assumptions on how the file is structured, but if you want to start your own data viz blog and take the few readers I have, then you might find the script helpful. You can grab it <a href="https://github.com/mwburke/mwburke.github.io/blob/master/create_yaml_json.py">in the github repo</a> for this site or below if you don’t want an extra click:</p>

<pre><code class="language-python">
import sys
import json, pyaml

def read_json(json_file):
    with open(json_file, 'r') as f:
    	return json.load(f)

def write_yaml(data, output_file):
	with open('_data/' + output_file + '.yaml', 'w') as output:
		pyaml.dump(data, output)

def write_json_instructions(columns, output_file):
	with open('data/' + output_file + '.json', 'w') as output:
		output.write('---\nlayout: none\n---\n')
		output.write('[{{% for chart in site.data.{} %}}'.format(output_file))
		output.write('\t{{\n')
		count = 0
		for column in columns:
			output.write('"{0}": {{{{ chart.{1} }}}}"'.format(column, column))
			if count != len(columns) - 1:
				output.write(',')
			output.write('\n')
			count += 1
		output.write('\t}{% if forloop.last == false %},{% endif %}\n{{{% endfor %}]')


if __name__ == '__main__':
	input_file = sys.argv[1]
	output_file = sys.argv[2]

	data = read_json(input_file)
	write_yaml(data, output_file)
	write_json_instructions(list(data[0].keys()), output_file)
</code></pre>

    </article>
    
</div>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="http://worksofchart.com/assets/img/other-profile.jpg" alt="">
        </div>
        <div class="author-name" rel="author">Matthew Burke</div>
        <div class="bio">
            <p>Data Visualization, Machine Learning, Optimization</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="//twitter.com/mattburkeley" target="_blank">
                    <i class="iconfont icon-twitter"></i>
                </a>
            </li>
            
            <li>
                <a href="//www.linkedin.com/in/matthew-burke-data-science" target="_blank">
                    <i class="iconfont icon-linkedin"></i>
                </a>
            </li>
            
            <li>
                <a href="//github.com/mwburke" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        <div class="read-next-item">
            <a href="/2018/04/29/population-stability-index.html" class="read-next-link"></a>
            <section>
                <span>Population Stability Index</span>
                <p>What is the population stability index (PSI)?PSI is a mea...</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://raw.githubusercontent.com/mwburke/population-stability-index/master/images/distributions.png" alt="">
            
        </div>
        
        
        <div class="read-next-item">
            <a href="/2017/12/28/slopegraph-vs-barchart.html" class="read-next-link"></a>
            <section>
                <span>Slopegraph vs Barchart</span>
                <p>Slopegraphs are great (…sometimes)A slopegraph is a relat...</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://raw.githubusercontent.com/mwburke/ds-tools-2017-slopegraph/master/preview.png" alt="">
            
        </div>
        
    </section>
    
</section>

<footer class="g-footer">
    <section>Works of Chart © 2018</section>
    <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>

<script src="/assets/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: ['twitter','linkedin','github'],
        wechatQrcodeTitle: "分享到微信朋友圈",
        wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
</script>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
/*写入自己的disqus信息*/
s.src = 'https://mwburke.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="/assets/js/prism.js"></script>
<script src="/assets/js/index.min.js"></script>
</body>
</html>
