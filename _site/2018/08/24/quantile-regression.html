<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantile Regression: Interpretable Linear Modeling - Works of Chart</title>
    <meta name="author"  content="Matthew Burke">
    <meta name="description" content="Quantile Regression: Interpretable Linear Modeling">
    <meta name="keywords"  content="python, regression, data-science, ml">
    <!-- Open Graph -->
    <meta property="og:title" content="Quantile Regression: Interpretable Linear Modeling - Works of Chart">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2018/08/24/quantile-regression.html">
    <meta property="og:description" content="Making sense of data">
    <meta property="og:site_name" content="Works of Chart">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    
    <!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

    
</head>
<body>
    <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
<input id="nm-switch" type="hidden" value="false">

<header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


<header class="g-banner post-header post-pattern-circuitBoard bgcolor-default " data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="http://localhost:4000/tags#python" class="post-tag">python</a>
            
            <a href="http://localhost:4000/tags#regression" class="post-tag">regression</a>
            
            <a href="http://localhost:4000/tags#data-science" class="post-tag">data-science</a>
            
            <a href="http://localhost:4000/tags#ml" class="post-tag">ml</a>
            
            
        </div>
        <h1>Quantile Regression: Interpretable Linear Modeling</h1>
        <div class="post-meta">
            <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="http://localhost:4000" target="_blank" rel="author">Matthew</a></></span>
            <time class="post-meta-item" datetime="18-08-24"><i class="iconfont icon-date"></i>24 Aug 2018</time>
        </div>
    </div>
    
    <div class="filter"></div>
    <div class="post-cover" style="background: url('/assets/img/quantile_slope_values.png') center no-repeat; background-size: cover;">
    
</header>

<div class="post-content">
    
    <article class="markdown-body">
        <h1 id="black-box-machine-learning">Black Box Machine Learning</h1>

<p>The trend in machine learning these days seems to be heading more and more towards deep learning and extensive tree-based ensemble algorithms, which in turn results in a lot of models becoming <a href="https://en.wikipedia.org/wiki/Black_box">black box</a> algorithms, which nobody can fully explain. In the past, researchers were forced to use more simple, explainable techniques due to lack of compute power, but now with the advent of cloud computing and the ability to spin up clusters of high-powered CPUs and GPUs, those limitations have been removed and people have to trust that their cross-validation ensures applicability to unseen data.</p>

<p>My current job places a lot of emphasis on interpretability of models that get put into production, eliminating that inherent need to rely on algorithms or using methods to explain local behavior of models at specific points such as <a href="https://arxiv.org/pdf/1602.04938.pdf">LIME</a>. This has caused me to approach problem solving in a different way and look for methods that tow the line between performance and interpretability.</p>

<h2 id="quantile-regression">Quantile Regression</h2>

<p><a href="https://en.wikipedia.org/wiki/Quantile_regression">Quantile regression</a> is one of those techniques my colleagues and I have looked into that fulfills these requirements by fitting multiple linear regressions locally at different quantile points in the data.</p>

<p>This method captures the non-linear relationships between the covariates tne response variable close to each quantile while still having linear coefficients that are easily understandable from a human researcher for any given point. This has the potential to increase model performance drastically, especially for problems that have normally distributed response variables, where linear models tend to perform poorly outside of the mean.</p>

<h2 id="housing-example">Housing Example</h2>

<p>I used the <a href="https://www.kaggle.com/c/boston-housing">Boston housing dataset</a> to do a quick benchmark of standard linear regression versus quantile regression based on its non-uniform distribution of the median house price (target variable):</p>

<p><img src="/assets/img/quantile_target_distribution.png" alt="" /></p>

<p>It appears as if there is a normal distribution with some outliers at the high end that may cap the median house value at 50.</p>

<p>I trained a standard OLS model on the data as well as a quantile regression model made up of individual regressions performed locally at each 0.05 quantile from 0 to 1 and compared the accuracy results below:</p>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Base Regression</th>
      <th>Quantile Regression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MAE</td>
      <td>3.271</td>
      <td>2.95</td>
    </tr>
    <tr>
      <td>MSE</td>
      <td>21.895</td>
      <td>16.257</td>
    </tr>
    <tr>
      <td>R<sup>2</sup></td>
      <td>0.741</td>
      <td>0.807</td>
    </tr>
  </tbody>
</table>

<p>The results show a definite increase in overall error reduction as well as more variance explained by the quantile regression. Additionally, if you look at the plot below, you can see that the blue points (simple OLS model) tend to have larger errors around the upper and lower points of the target variable, which is consistent with our expectations.</p>

<p><img src="/assets/img/quantile_comparison.png" alt="" /></p>

<p>This is all great, but how is this interpretable if we have 19 individual models fit, each with their own sets of coefficients with intercepts, slopes and confidence intervals? One easy way would be to plot the values for each covariate independently as a function of the quantile on which they were trained to see how the relationships vary in terms of the response variable. Below is a quick example comparing the simple OLS model slopes vs each of the covariates’ quantile regression results:</p>

<p><img src="/assets/img/quantile_slope_values.png" alt="" /></p>

<p>If you take a look at the <a href="https://github.com/mwburke/mwburke.github.io/tree/master/scripts/quantile_regression.py">file used to create these plots/calculations</a>, you can look at how I have done these calculations and probably augment the charts to include upper/lower bounds as well as intercept values to get an even fuller picture of how your models are functioning, to the point where you could explain to management, your mom, unwilling friends, etc…</p>

<h2 id="summary">Summary</h2>

<p>Although quantile regression doesn’t move past the basic linear approaches of OLS, it does allow some flexibility and can be a good compromise being stuck with the most basic techniques and being able to eek out a little extra accuracy for your models without sacrificing interpretability.</p>

<h3 id="extra-note">Extra Note</h3>

<p>If you are allows even a little more flexibility than that, I’d highly recommend checking out <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">generalized additive models</a>, which supports non-linear modeling of linear predictors while remaining interpretability and allowing many customizations such as monotonic constraints and smoothing parameters. Stitch Fix has a <a href="https://multithreaded.stitchfix.com/blog/2015/07/30/gam/">fantastic article</a> on it, and there’s a convenient <a href="https://github.com/dswah/pyGAM">python library</a> you might find helpful as well in getting up and running quickly.</p>

<h2 id="additional-resources">Additional Resources</h2>

<p><a href="https://www.oreilly.com/learning/introduction-to-local-interpretable-model-agnostic-explanations-lime">Introduction to local Interpretable Model-agnostic Explanations (O’Reilly)</a></p>

<p><a href="https://arxiv.org/pdf/1602.04938.pdf">“Why Should I Trust You?” Explaining the Predictions of Any Classifier</a></p>

<p><a href="https://christophm.github.io/interpretable-ml-book/">Interpretable Machine Learning: A Guide for Making Black Box Models Explainable</a></p>

<p><a href="https://data.library.virginia.edu/getting-started-with-quantile-regression/">Getting Started With Quantile Regression</a></p>

    </article>
    
</div>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="http://localhost:4000/assets/img/other-profile.jpg" alt="">
        </div>
        <div class="author-name" rel="author">Matthew Burke</div>
        <div class="bio">
            <p>Data Science, Data Viz, Web Stuff (sorta)</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="//twitter.com/mattburkeley" target="_blank">
                    <i class="iconfont icon-twitter"></i>
                </a>
            </li>
            
            <li>
                <a href="//www.linkedin.com/in/matthew-burke-2017" target="_blank">
                    <i class="iconfont icon-linkedin"></i>
                </a>
            </li>
            
            <li>
                <a href="//github.com/mwburke" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        
        <div class="read-next-item">
            <a href="/2018/07/09/generative-art-p5js.html" class="read-next-link"></a>
            <section>
                <span>p5js Generative Art</span>
                <p>What is generative art?Generative art is procedurally gen...</p>
            </section>
            
            <div class="filter"></div>
            <img src="/assets/img/generative-art.png" alt="">
            
        </div>
        
    </section>
    
</section>

<footer class="g-footer">
    <section>Works of Chart © 2018</section>
    <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>

<script src="/assets/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: ['twitter','linkedin','github'],
        wechatQrcodeTitle: "分享到微信朋友圈",
        wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
</script>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
/*写入自己的disqus信息*/
s.src = 'https://mwburke.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="/assets/js/prism.js"></script>
<script src="/assets/js/index.min.js"></script>
</body>
</html>
